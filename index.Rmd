---
title       :
biglogo     : 
framework   : revealjs
revealjs    : {theme: solarized, transition=slide}
widgets     : []            # {mathjax, quiz, bootstrap}
mode        : selfcontained # {selfcontained, standalone, draft}
knit        : slidify::knit2slides
--- 




## The Impact of 2008 Economic Crisis across the U.S.
Team Citris (Sona, Ines, Sho, Jamie)

* Which social group was negatively affected the most after 2008 crisis by unemployment rate
  
* Bureau of Labor Statistics (BLS)
  + Demographic Data
    (http://www.bls.gov/lau/table14full + Year (last two digits) + “.xlsx”)
  + Industry Data
    (http://www.bls.gov/cew/datatoc.htm)

* Main Variables to Investigate (2004-2014)
  + Unemployment Rate
  + Age, Gender, Ethnicity
  + Industry
  + Region
  
* Methods
  + Data Merging: for loops/join
  + Data Cleaning :regrex,filter,mutate,grepl, ifelse
  
```{r,eval=FALSE}
for (year in 1:11){for (i in 1:nrow(area_codes)){
  state = area_codes[i, 2]
  filename = paste("industry/", state, " ", years[year],".csv", sep = "")
  data = read.file(filename)result = rbind(result, data) }}
    
Industry.data = Industry.data %>% left_join(Pre.Recession)

Ethnicity.Age = Demographics %>% filter(grepl("[years|over]$", Group))

Ethnicity.Age= Ethnicity.Age %>% mutate(Race = ifelse(grepl("^Hispanic", Group), "Hispanic", ifelse(grepl("^White", Group), "White", "Black")))

```

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE)

library(DataComputing)

library(dplyr)

library(ggplot2)

library(tidyr)

library(devtools)

library(cowplot)


```

```{r,echo=FALSE,fig.width=18, fig.height=7}
Industry.data = read.csv("~/Desktop/The citris/Industry.csv")
head(Industry.data,5)
```

---
## Analysis on Employment level- Region/Industry



```{r, echo=FALSE,message=F, warning=F}

Demographics<- read.csv("~/Desktop/The citris/Demographics.csv")
Demographics.3 <- read.csv("~/Desktop/The citris/Demographics_3.csv")
Demographics.3 <- Demographics.3[,-1]
divisionlabels <- read.csv("~/Desktop/The citris/division labels.csv")
Demographics.3 <- Demographics.3 %>% inner_join(divisionlabels)
##--------------------------------------------------------------

Ethnicity.Age = Demographics %>% 
  filter(grepl("[years|over]$", Group)) %>% 
  filter(grepl("^Hispanic", Group) | grepl("^White", Group) | grepl("^Black or African American", Group))  %>% 
  filter(Group!="Hispanic or Latino ethnicity" & Group!="White" & Group!="Black or African American")

Ethnicity.Age= Ethnicity.Age %>% mutate(Race = ifelse(grepl("^Hispanic", Group), "Hispanic", 
  ifelse(grepl("^White", Group), "White", "Black"))
                            )

Ethnicity.Age = Ethnicity.Age %>%  
  mutate(Age_Group = 
           ifelse(grepl("over$", Group), "65 years and over",
                              ifelse (grepl("64 years$", Group), "55 to 64 years",
                                ifelse(grepl("54 years$", Group), "45 to 54 years",
                                  ifelse(grepl("44 years$", Group), "35 to 44 years",
                                    ifelse(grepl("34 years$", Group), "25 to 34 years",
                                     ifelse(grepl("24 years$", Group), "20 to 24 years", "16 to 19 years")
                                    )
                                  )
                                )
                              )
            )
  )

Ethnicity.Age= Ethnicity.Age%>% mutate(Age_Group=factor(Age_Group, ordered=TRUE)) 
```



```{r,echo=FALSE}
Sex.Age = Demographics  %>% 
  filter(grepl("[years|over]$", Group)) %>% 
  filter(grepl("^Women", Group) | grepl("^Men", Group))  %>% 
  filter(Group!="Women" & Group!="Men")

Sex.Age= Sex.Age %>% mutate(Race = ifelse(grepl("^Women", Group), "Women", "Men"))

Sex.Age = Sex.Age %>%  
  mutate(Age_Group = 
           ifelse(grepl("over$", Group), "65 years and over",
                              ifelse (grepl("64 years$", Group), "55 to 64 years",
                              ifelse(grepl("54 years$", Group), "45 to 54 years",
                                  ifelse(grepl("44 years$", Group), "35 to 44 years",
                                    ifelse(grepl("34 years$", Group), "25 to 34 years",
                                      ifelse(grepl("24 years$", Group), "20 to 24 years", "16 to 19 years")
                                    )
                                  )
                                )
                              )
            )
  )

Sex.Age = Sex.Age %>% mutate(Age_Group=factor(Age_Group, ordered=TRUE))

```


```{r,echo=FALSE,fig.height=16,fig.width=30}

theme<- theme(
  panel.background = element_rect(fill = "honeydew2"), strip.background = element_rect(fill = "gray95", size = 2),plot.title = element_text(size=24),axis.title=element_text(size=18),axis.text=element_text(size=14),legend.text=element_text(size=18))

theme <- theme + theme(strip.text.x = element_text(size = 12))

 
industry.plotter = function(data, indus1, indus2, indus3="", indus4="", indus5="", indus6="", title, OV= F) {
    plot = data %>% filter(Year>2006) %>% filter( Industry %in% c(indus1, indus2, indus3, indus4, indus5, indus6)) %>% ggplot(aes(x=Year, y=EmpLvl.change, color = Industry)) + geom_line() +ggtitle(title) + scale_y_continuous(labels = scales::percent) +ylab("Employment Level Change (Relative to Pre-Recession Levels") + theme + facet_wrap(facets= ~ State, nrow=2)
    if(OV){
       plot = data %>% mutate(Overview= ifelse(Industry=="Total, all industries", T, F )) %>%       
                filter(Year>2006) %>% 
                filter( Industry %in% c(indus1, indus2, indus3, indus4, indus5, indus6)) %>% 
                  ggplot(aes(x=Year, y=EmpLvl.change, color = Industry, linetype= Overview)) + 
                  geom_line() +ggtitle(title) + guides(linetype =F) +
                  scale_y_continuous(labels = scales::percent) +
                  ylab("Employment Level Change") + 
                  theme + facet_wrap(facets= ~ State, nrow=2) 
    }
  return(plot )
}


Goods.and.Service = function(data){
  industry.plotter(data, indus1 = "Goods-producing", indus2= "Service-providing", indus3= "Total, all industries", title= "Goods-Producing vs. Service-Providing")
}

Manufacturing = function(data) {
  industry.plotter(data, indus1 = "Manufacturing", indus2= "Total, all industries", title= "Manufacturing")
}

Constr.ResBuilding = function(data){
  industry.plotter(data, indus1= "Construction", indus2= "Residential building construction", indus3= "Total, all industries", title = "Construction, Resid. Building Construction")
} 
  
Finance.Insurance =  function(data) {
  industry.plotter(data, indus1= "Finance and insurance", indus2= "Total, all industries", title = "Finannce & Insurance")
}

Overview = function(data, OV=T){
  industry.plotter(data, indus1 ="Goods-producing", indus2= "Service-providing", indus3= "Trade, transportation, and utilities", indus4= "Public administration", indus5= "Education and health services", indus6= "Total, all industries", title = "Overview of Employment Levels at Different Industries", OV=OV)
}

#--------------------------

California = Industry.data %>% filter(grepl("^Cali", State))


Michigan = Industry.data %>% filter(grepl("^Mich", State))


Mass = Industry.data %>% filter(grepl("^Mass", State))


Missouri =Industry.data %>% filter(grepl("^Miss", State)) 


NY = Industry.data %>% filter(grepl("^New", State))

P10<-Goods.and.Service (Industry.data)
P11<-Manufacturing(Industry.data)
P12<-Constr.ResBuilding(Industry.data)
P13<-Finance.Insurance(Industry.data)
P14<-Overview(Industry.data)

P15<- Demographics.3 %>% ggplot(aes(x=Year,y=U.p,col=label))+geom_smooth(se=FALSE)+geom_vline(xintercept = 2008)+ scale_x_continuous(breaks=c(2003,2005,2007,2009,2011,2013))+scale_y_continuous(breaks=c(4,8,12,16,20,24))+theme+ggtitle("unemployment rate change across the region")

#-------------
plot_grid(P15,P10,P11,P12,P13,P14,ncol=3,nrow=2)

```

---

## Which demographic group was negatively affected the most?       
## in which region? 
```{r,echo=FALSE,fig.height=16,fig.width=30}

new_age <- Demographics %>% filter(Group=="Total, 16 to 19 years"|Group=="Total, 20 to 24 years"|Group=="Total, 25 to 34 years"|Group=="Total, 35 to 44 years"|Group=="Total, 45 to 54 years"|Group=="Total, 55 to 64 years"|Group=="Total, 65 years and over")

P1<-ggplot(new_age,aes(x=Year,y=U.p,col=Group))+geom_smooth(se=FALSE)+theme+ggtitle("Unemployment rate across age group ")

#--------------------------

age_graph_CAMINY <- Demographics.3 %>% filter(label=="Pacific"|label=="Midwest"|label=="Midwest North"|label=="New England") %>% filter(Group=="Total, 16 to 19 years"|Group=="Total, 20 to 24 years"|Group=="Total, 25 to 34 years"|Group=="Total, 35 to 44 years"|Group=="Total, 45 to 54 years"|Group=="Total, 55 to 64 years"|Group=="Total, 65 years and over")

P2 <- ggplot(age_graph_CAMINY,aes(x=Year,y=U.p,col=Group)) + geom_smooth(se=FALSE) +facet_wrap(~label)+ggtitle("Age unemployment rate across regions")+ theme +scale_x_continuous(breaks=c(2003,2005,2007,2009,2011,2013))+scale_y_continuous(breaks=c(4,8,12,16,20,24))+ geom_vline(xintercept = 2008)+ theme(legend.position="none")

#--------------------------

colnames(Sex.Age)[colnames(Sex.Age)=="Race"] <- "Sex"

P3 <- Sex.Age %>% ggplot(aes(x=Year,y=U.p,col=Age_Group))+geom_smooth(se=FALSE)+facet_grid(~Sex)+ theme+ theme(legend.position="none")+ggtitle("The age unemployment rate across sex")+theme(legend.position="none")

#------------------------

all_races <- Demographics %>% filter(Group == "Men" | Group == "Women")

P4 <-  ggplot(all_races,aes(x = Year, y = U.p, col = Group)) + geom_smooth(se = FALSE) + ylab("Unemployment Percent") + ggtitle("Unemployment rate across gender group") + theme  + geom_vline(xintercept = 2008) + scale_x_continuous(breaks = c(2003, 2005, 2007, 2009, 2011, 2013))

#------------------------

gender_across_races_facet <- Demographics %>% filter(Group == "Black or African American, men" | Group == "Black or African American, women" | Group == "Hispanic or Latino ethnicity, men" | Group == "Hispanic or Latino ethnicity, women" | Group == "White, men" | Group == "White, women" | Group == "Asian, men" | Group == "Asian, women")

P5 <-  ggplot(gender_across_races_facet,aes(x = Year, y = U.p, col = Group)) + geom_smooth( se = FALSE) + ylab("Unemployment Percent") + ggtitle("Gender Unemployment across Races")  + theme  + geom_vline(xintercept = 2008) + scale_x_continuous(breaks = c(2003, 2005, 2007, 2009, 2011, 2013))+theme(legend.position="none")


#-------------------

gender_across_region_facet <- Demographics.3 %>% filter(Group == "Men" | Group == "Women") %>% filter(label == "Midwest North" | label == "Midwest" | label == "Pacific" | label == "New England")

P6 <-  ggplot(gender_across_region_facet,aes(x = Year, y = U.p, col = Group)) + geom_smooth(se=FALSE) + ylab("Unemployment Percent") + ggtitle("Gender unemployment rate across regions") + facet_wrap(~ label) + scale_x_continuous(breaks = c(2003, 2005, 2007, 2009, 2011, 2013)) + geom_vline(xintercept = 2008) + theme+theme(legend.position="none")

#----------------------
New_Ethnicity <- Demographics.3 %>%

filter(Group=="Black or African American"|Group=="Hispanic or Latino ethnicity" |

Group=="White"| Group=="Asian")

P7 <- ggplot(New_Ethnicity,aes(x=Year,y=U.p))+geom_smooth(aes(col=Group),se=FALSE)+ ggtitle("Unemployment rate across ethnicity group")+geom_vline(xintercept = 2008)+ylab("Unemployment Rate, %") + xlab("Year") + scale_x_continuous(breaks=c(2003,2005,2007,2009,2011,2013))+scale_y_continuous(breaks=c(4,8,12,16,20,24))+ geom_vline(xintercept = 2008)+theme
#-----------------

P8<- New_Ethnicity %>% filter(label=="New England"|label=="Pacific"|label=="Midwest"|label=="Midwest North") %>%

  ggplot(aes(x=Year,y=U.p))+geom_smooth(aes(col=Group),se=FALSE)+facet_wrap(~label)+ggtitle("Ethnicity unemployment rate across regions") + geom_vline(xintercept = 2008)+ylab("Unemployment Rate, %") + xlab("Year") + scale_x_continuous(breaks=c(2003,2005,2007,2009,2011,2013))+scale_y_continuous(breaks=c(4,8,12,16,20,24))+ geom_vline(xintercept = 2008)+theme+theme(legend.position="none")
#---------------

P9 <- Ethnicity.Age %>% filter(Group=="White, 20 to 24 years"| Group=="Black or African American, 20 to 24 years"|Group=="Hispanic or Latino ethnicity, 20 to 24 years") %>%  ggplot(aes(x=Year,y=U.p,col=Group))+geom_smooth(se=FALSE)+xlab("Year")+ylab("Unemployment Rate")+theme_grey(base_size = 12)+ggtitle("Ethnicity Unemployment across Age, 20-24") +ylab("Unemployment Rate, %") + xlab("Year") + scale_x_continuous(breaks=c(2003,2005,2007,2009,2011,2013))+scale_y_continuous(breaks=c(4,8,12,16,20,24))+ geom_vline(xintercept = 2008)+theme+theme(legend.position="none")
#---------------


plot_grid(P1,P4,P7,P2,P6,P8, ncol = 3, nrow = 2)



```



